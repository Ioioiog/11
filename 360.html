<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360° Panorama Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
    }
    
    .viewer-container {
      position: fixed;
      inset: 0;
      background: black;
    }
    
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.25rem;
    }
    
    .info-panel {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      padding: 1.5rem;
      border-radius: 1rem;
      max-width: 24rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .info-panel h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .info-panel p {
      margin: 0;
      color: #4B5563;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="viewer" class="viewer-container"></div>
  
  <div id="loading" class="loading-overlay">
    Loading panorama...
  </div>
  
  <div id="info" class="info-panel" style="display: none;">
    <h2>360° Panorama View</h2>
    <p>Click and drag to look around. Use the mouse wheel to zoom in and out.</p>
  </div>
  <script>
    let scene, camera, renderer, controls;
    const loadingElement = document.getElementById('loading');
    const infoPanel = document.getElementById('info');
    
    function init() {
      // Scene setup
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('viewer').appendChild(renderer.domElement);
      // Create cylinder for panorama
      const geometry = new THREE.CylinderGeometry(50, 50, 50, 60, 1, true);
      geometry.scale(-1, 1, 1);
      
      // Load panorama texture
      const loader = new THREE.TextureLoader();
      loader.load(
        '/assets/360/b110.jpg',
        (texture) => {
          texture.wrapS = THREE.RepeatWrapping;
          texture.repeat.x = -1;
          
          const material = new THREE.MeshBasicMaterial({ map: texture });
          const cylinder = new THREE.Mesh(geometry, material);
          scene.add(cylinder);
          
          loadingElement.style.display = 'none';
          infoPanel.style.display = 'block';
          console.log('Panorama loaded successfully');
          
          camera.position.set(0, 0, 0.1);
          setupControls();
        },
        undefined,
        (error) => {
          console.error('Error loading panorama:', error);
          loadingElement.textContent = 'Error loading panorama';
        }
      );
      // Handle window resize
      window.addEventListener('resize', onWindowResize);
    }
    function setupControls() {
      let isDragging = false;
      let previousMousePosition = { x: 0, y: 0 };
      document.addEventListener('mousedown', (e) => {
        isDragging = true;
        previousMousePosition = {
          x: e.clientX,
          y: e.clientY
        };
      });
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const deltaMove = {
          x: e.clientX - previousMousePosition.x,
          y: e.clientY - previousMousePosition.y
        };
        camera.rotation.y += deltaMove.x * 0.005;
        camera.rotation.x += deltaMove.y * 0.005;
        // Limit vertical rotation
        camera.rotation.x = Math.max(-1, Math.min(1, camera.rotation.x));
        previousMousePosition = {
          x: e.clientX,
          y: e.clientY
        };
      });
      document.addEventListener('mouseup', () => {
        isDragging = false;
      });
      // Zoom controls
      document.addEventListener('wheel', (e) => {
        camera.position.z += e.deltaY * 0.001;
        camera.position.z = Math.max(0.1, Math.min(2, camera.position.z));
      });
    }
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    // Initialize and start animation
    init();
    animate();
  </script>
</body>
</html>
